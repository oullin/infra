; =================================================================
; Supervisor config for the Oullin API Docker Compose service
; =================================================================

[program:oullin-api]

; --- Command ---
; The full path to the command to be executed.
; We use 'docker compose up' to start the services defined in our docker-compose.yml.
; NOTE: This assumes Docker Compose V2. If you use V1, the command would be '/usr/bin/docker-compose up'.
command=/usr/bin/docker compose up

; --- Process Management ---
; The directory from which to run the command. This MUST be the path to your 'docker-compose.yml' file.
directory=/home/gocanto/Sites/oullin/api

; The user to run the process as. Best practice is to use the project owner.
user=gocanto

; Start the service automatically when supervisord starts (e.g., on server boot).
autostart=true

; ** KEY SETTING **
; Automatically restart the process if it exits unexpectedly.
autorestart=true

; How long to wait before restarting (in seconds).
startsecs=10

; How many times to retry starting before giving up.
startretries=3

; --- Process Shutdown ---
; When stopping, send the SIGINT signal (Ctrl-C), which docker-compose handles gracefully.
stopsignal=INT

; How long to wait for the process to stop gracefully before killing it (in seconds).
; Docker might need a moment to shut down containers.
stopwaitsecs=30

; When stopping, ensure the entire process group (docker compose and its child containers) is killed.
killasgroup=true

; --- Logging ---
; Where to send the standard output and error logs.
stdout_logfile=/var/log/supervisor/oullin-api.log
stderr_logfile=/var/log/supervisor/oullin-api.err.log
stdout_logfile_maxbytes=100MB
stdout_logfile_backups=5
